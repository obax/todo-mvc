#!/usr/bin/env php

<?php

use Symfony\Component\Console;
use Symfony\Component\Console\Helper\QuestionHelper;
use Doctrine\Migrations\Tools\Console\Command as MigrationsCommand;
use Doctrine\Common\Version;
use Doctrine\DBAL\Connection;
use \Doctrine\DBAL\Driver\PDOMySql\Driver;


require __DIR__ . '/../vendor/autoload.php';
$connectionConf = new Connection( require_once __DIR__ . '/../config/doctrine-conf.php', new Driver());

// Instantiate console application
$cli = new Console\Application('Doctrine Migrations', Version::VERSION);
$cli->setCatchExceptions(true);

$helperSet = new Console\Helper\HelperSet();
$helperSet->set(new QuestionHelper(), 'dialog');
$cli->setHelperSet($helperSet);


// Add Migrations commands
$commands = array();

$executeCommand = new MigrationsCommand\ExecuteCommand();
//$executeCommand->setMigrationConfiguration($migrationConf);
$executeCommand->setConnection($connectionConf);
$commands[] = $executeCommand;

$migrationCommand = new MigrationsCommand\MigrateCommand();
$migrationCommand->setConnection($connectionConf);
$commands[] = $migrationCommand;

$generateCommand = new MigrationsCommand\GenerateCommand();
$generateCommand->setConnection($connectionConf);
$commands[] = $generateCommand;

$commands[] = new MigrationsCommand\LatestCommand();
$commands[] = new MigrationsCommand\StatusCommand();
$commands[] = new MigrationsCommand\VersionCommand();


$cli->addCommands($commands);

// Run!
$cli->run();